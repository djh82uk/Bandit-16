# Bandit-16
A 16-bit Computer CPU based on a custom ISA, it has a 16-bit Address bus and a 16-bit Data bus with 32-bit instructions and an addressable IO.  It supports 64k X 16 bits ROM and 64k X 16 bits RAM.

**The main sections of this design are:*
- 16-Bit Program Counter (PC)
- 4 General Purpose Registers (A, B, X & Y)
- 3 1-bit Flag Registers (Carry, Zero and Input Buffer Not Empty (used with the Addressable IO))
- 32-Bit Instruction Register (IR)
- 16-Bit Memory Address resgister (MAR)
- 64K x 16 Bit RAM
- 64K x 16 Bit ROM
- Customisable Stack (Always Decrements on PUSH, but can start from any Ram Address with no limits (It can consume all of RAM if desired, though with no protection))
- 16-Bit ALU with 2 Input Registers and support for 16-bit operations (ADD, SUB, AND, OR, XOR, Shift Left, and Shift Right, shift operations only support shifting by 1-bit at a time)
- Control Unit with 4 Microcode-Roms (32K x 8 bits, can add additional roms easily for more control lines) 

## Directly Accessible Control Lines:

| **Control Line** | **Push/Pull**     | **Description**                                                                                                                                                                                           | **Microcode ROM** | **Microcode ROM PIN** |
|------------------|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------|-----------------------|
| CE               | N/A               | Counter Enable: When high, this will enable the Program Counter to Increment                                                                                                                              | 1                 | 0                     |
| CO               | PUSH              | Counter Out: When high, this will output the 16-bit counter value to the Data Bus                                                                                                                         | 1                 | 1                     |
| MI               | PULL              | Memory Address Register IN: When high, this will load the contents of the Data Bus into the MAR (Which will be treated as the address for RAM/ROM                                                         | 1                 | 2                     |
| RAO              | PUSH              | RAM Out: When high, the data that resides in the currently set RAM address (by the MAR) will be output to the Data Bus                                                                                    | 1                 | 3                     |
| RAI              | PULL              | RAM In: When high, the data that is on the Data Bus will be stored at the RAM address currently set by the MAR                                                                                            | 1                 | 4                     |
| ROO              | PUSH              | ROM Out: When high, the data that resides in the currently set ROM address (by the MAR) will be output to the Data Bus                                                                                    | 1                 | 5                     |
| CDO              | PUSH              | Counter Data Out: When high, the current PC value is output to the Data Bus                                                                                                                               | 1                 | 6                     |
| HLT              | N/A               | HALT: Halts the CPU (non-recoverable)                                                                                                                                                                     | 1                 | 7                     |
| RegOut           | PUSH              | Registry Out: This is a general control line to output the contents of one of the 4 GP registers to the Data Bus, the register is selected by bits 3:2 of the upper 16-bit word of the 32-bit instruction | 2                 | 0                     |
| RegIn            | PULL              | Registry In: This is a general control line to store the contents of the Data Bus into one of the 4 GP registers, the register is selected by bits 1:0 of the upper 16-bit word of the 32-bit instruction | 2                 | 1                     |
| IIL              | PULL              | Instruction Register IN Lower Word: Store the current value of the Data Bus into the Lower 16-bits of the 32-bit Instruction Register                                                                     | 2                 | 2                     |
| IIH              | PULL              | Instruction Register IN Upper Word: Store the current value of the Data Bus into the Upper 16-bits of the 32-bit Instruction Register                                                                     | 2                 | 3                     |
| IOL              | PUSH              | Instruction Register Out Lower Word: Output the Lower 16-bits of the 32-bit Instruction Register to the Data Bus                                                                                          | 2                 | 4                     |
| IOH              | PUSH              | Instruction Register Out Upper Word: Output the Upper 16-bits of the 32-bit Instruction Register to the Data Bus                                                                                          | 2                 | 5                     |
| IOO              | PUSH              | IO Out: Output the current value on the Data Bus to the IO Address (set by lower 16-bits of the Instruction)                                                                                              | 2                 | 6                     |
| IOI              | PULL              | IO In: Pull the current value at the IO Address (set by lower 16-bits of the Instruction) onto the Data Bus                                                                                               | 2                 | 7                     |
| JMP              | N/A               | JUMP: Set Program Counter to the value in the lower 16-bits of the Instruction (Address)                                                                                                                  | 3                 | 0                     |
| JC               | N/A               | JUMP if Carry: Set Program Counter to the value in the lower 16-bits of the Instruction (Address), but only if the Carry flag is set in the flags register                                                | 3                 | 1                     |
| JZ               | N/A               | JUMP if Zero: Set Program Counter to the value in the lower 16-bits of the Instruction (Address), but only if the Zero flag is set in the flags register                                                  | 3                 | 2                     |
| JNZ              | N/A               | JUMP if NOT Zero: Set Program Counter to the value in the lower 16-bits of the Instruction (Address), but only if the Zero flag is NOT set in the flags register                                          | 3                 | 3                     |
| ALURO            | PUSH              | ALU Result Out: Output the result from the ALU to the Data Bus                                                                                                                                            | 3                 | 4                     |
| EndCMD           | N/A               | End Command: Trigger the Instruction to finish early (rather than waiting for the full 16 micro steps to complete when they are not used)                                                                 | 3                 | 5                     |
| IOLA             | PUSH (Address)    | Instruction Register Out Lower Word To Address Bus: Pushes the lower 16-bits of the Instruction register to the Address Bus (typically for consumption by the MAR)                                        | 3                 | 6                     |
| FI               | PULL (From Flags) | Flag Register In: Latch all flag statuses to the flags register (required before any conditional jump)                                                                                                    | 3                 | 7                     |
| ALUOP1           | PULL              | ALU Register 1 In: Store the contents of the Data Bus into the 1st ALU register                                                                                                                           | 4                 | 0                     |
| ALUOP2           | PULL              | ALU Register 2 In: Store the contents of the Data Bus into the 2nd ALU Register                                                                                                                           | 4                 | 1                     |
| JNI              | N/A               | JUMP if New Input: Set Program Counter to the value in the lower 16-bits of the Instruction (Address), but only if the New Input flag is set in the flags register                                        | 4                 | 2                     |
| SPIn             | PULL              | Stack Pointer In: Store the contents of the Data Bus into the stack pointer register (update the stack pointer)                                                                                           | 4                 | 3                     |
| SPDOut           | PUSH              | Stack Pointer Out: Push the current stack pointer value to the Data Bus                                                                                                                                   | 4                 | 4                     |
| SPAOut           | PUSH (Address)    | Stack Pointer Out: Push the current stack pointer value to the Address Bus                                                                                                                                | 4                 | 5                     |
| SPINC            | N/A               | Stack Pointer Increment: Increment the stack pointer by 1                                                                                                                                                 | 4                 | 6                     |
| SPDEC            | N/A               | Stack Pointer Decrement: Decrement the stack pointer by 1                                                                                                                                                 | 4                 | 7                     |
| JN               | N/A               | JUMP if Negative: Set Program Counter to the value in the lower 16-bits of the Instruction (Address), but only if the Negative flag is set in the flags register                                          | 5                 | 0                     |
| JO               | N/A               | JUMP if Overflow: Set Program Counter to the value in the lower 16-bits of the Instruction (Address), but only if the Overflow flag is set in the flags register                                          | 5                 | 1                     |
| NC1              | N/A               | Not In Use (Future Expansion)                                                                                                                                                                             | 5                 | 2                     |
| NC2              | N/A               | Not In Use (Future Expansion)                                                                                                                                                                             | 5                 | 3                     |
| NC3              | N/A               | Not In Use (Future Expansion)                                                                                                                                                                             | 5                 | 4                     |
| NC4              | N/A               | Not In Use (Future Expansion)                                                                                                                                                                             | 5                 | 5                     |
| NC5              | N/A               | Not In Use (Future Expansion)                                                                                                                                                                             | 5                 | 6                     |
| NC6              | N/A               | Not In Use (Future Expansion)                                                                                                                                                                             | 5                 | 7                     |

## Instruction Detail:

| Alignment                | Upper Word 1-byte | Upper Word 1-nibble | Upper Word 2-bit        | Upper Word 2-bit             | Lower Word 2-byte                |
|--------------------------|-------------------|---------------------|-------------------------|------------------------------|----------------------------------|
| Instruction Layout       | Op-code [31:24]   | Sub-Op-code [23:20] | Register Source [19:18] | Register Destination [17:16] | Address / Immediate Value [15:0] |
| Blank Example            | XXXXXXXX          | XXXX                | XX                      | XX                           | XXXXXXXXXXXXXXXX                 |
| Example (LDI B [0x00FF]) | 00000100          | 0000                | 00                      | 01                           | 0000000011111111                 |
| Example (ADD X)          | 00000101          | 0001                | 00                      | 02                           | 0000000000000000                 |

## Instructions:

<div style="overflow-x: auto;">

| Instruction | Description                                                                                                                                        | Step1  | Step2        | Step3          | Step4        | Step5             | Step6       | Step7    | Step8    | Step9    | Step10   | Step11   | Step12   | Step13   | Step14   | Step15   | Step16   |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------|--------|--------------|----------------|--------------|-------------------|-------------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| NOP         | No Operation (Dummy Instruction that burns 3 cpu cycles)                                                                                           | CO, MI | ROO, IIH, CE | EndCMD         | Not Used     | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| MOV         | Move the contents of one register, into another (e.g. MOV A, B)                                                                                    | CO, MI | ROO, IIH, CE | RegOut, RegIn  | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| LD          | Move the contents of RAM to a register (e.g. LD A, [0x00FF])                                                                                       | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOLA, MI          | RegIn, RAO  | EndCMD   | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| ST          | Store the content of a register into RAM (e.g. ST B, [0x00EF])                                                                                     | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOLA, MI          | RegOut, RAI | EndCMD   | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| LDI         | Load a 16-bit value from the Instruction directly into a register (e.g. LDI A, 0x02FE)                                                             | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, RegIn        | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| ALU         | Perform an ALU operation and output the result to a register.  Requires ALU Sub-OP and destination register in the instruction                     | CO, MI | ROO, IIH, CE | RegIn, ALURO   | FI           | EndCMD            | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JMP         | Update the program counter to "jump" to a new rom address (e.g. JMP 0x00AA)                                                                        | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JMP          | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JZ          | Update the program counter to "jump" to a new rom address (e.g. JZ 0x00AA), but only if the ZERO flag is set high                                  | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JZ           | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JNZ         | Update the program counter to "jump" to a new rom address (e.g. JNZ 0x00AA), but only if the ZERO flag is set low                                  | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JNZ          | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JC          | Update the program counter to "jump" to a new rom address (e.g. JC 0x00AA), but only if the CARRY flag is set high                                 | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JC           | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JNI         | Update the program counter to "jump" to a new rom address (e.g. JNI 0x00AA), but only if the NEW INPUT flag is set high                            | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JNI          | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JN          | Update the program counter to "jump" to a new rom address (e.g. JN 0x00AA), but only if the NEGATIVE flag is set high                              | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JN           | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JO          | Update the program counter to "jump" to a new rom address (e.g. JO 0x00AA), but only if the OVERFLOW flag is set high                              | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOL, JO           | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| IOO         | Output a Register to the Addressable IO (e.g. IOO A, [0x0004])                                                                                     | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOLA, IOO, RegOut | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| IOI         | Input from the addressable IO to a register (e.g. IOI X, [0x0008])                                                                                 | CO, MI | ROO, IIH, CE | CO, MI         | ROO, IIL, CE | IOLA, IOI, RegIn  | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| HLT         | Halts the CPU, non recoverable without a reboot (e.g. HLT)                                                                                         | CO, MI | ROO, IIH, CE | HLT            | Not Used     | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| ALULD1      | Copy the contents of a GP register in to the 1st ALU staging register (e.g. ALULD1 A)                                                              | CO, MI | ROO, IIH, CE | RegOut, ALUOP1 | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| ALULD2      | Copy the contents of a GP register in to the 2nd ALU staging register (e.g. ALULD2 B)                                                              | CO, MI | ROO, IIH, CE | RegOut, ALUOP2 | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| CMP         | Compare the contents of two registers, use the flags to branch on the result (e.g. CMP A, B - Equal = Z=1, C=0 A < B = Z=0, C=1, A > B = Z=0, C=0) | CO, MI | ROO, IIH, CE | FI             | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| SPIN        | Update the Stack Pointer value from a register (e.g. SPIN X)                                                                                       | CO, MI | ROO, IIH, CE | RegOut, SPIn   | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| SPDOut      | Output the Stack pointer to a register                                                                                                             | CO, MI | ROO, IIH, CE | RegIn, SPDOut  | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| SPAPOP      | Pull from the stack (uses the current address in the stack pointer)                                                                                | CO, MI | ROO, IIH, CE | SPINC          | MI, SPAOut   | RegIn, RAO        | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| SPAPUSH     | Push to the stack (uses the current address in the stack pointer)                                                                                  | CO, MI | ROO, IIH, CE | MI, SPAOut     | RegOut, RAI  | SPDEC             | EndCMD      | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| SPINC       | Increment the stack pointer by 1                                                                                                                   | CO, MI | ROO, IIH, CE | SPINC          | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| SPDEC       | Decrement the stack pointer by 1                                                                                                                   | CO, MI | ROO, IIH, CE | SPDEC          | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| FI          | Latch all of the flags to the flags register (so they can be check next cycle)                                                                     | CO, MI | ROO, IIH, CE | FI             | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| LDCO        | Copy the current Program Counter value to a register                                                                                               | CO, MI | ROO, IIH, CE | CDO, RegIn     | EndCMD       | Not Used          | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |
| JMPR        | Update the program counter to "jump" to a new rom address from a register (e.g. JMP B)                                                             | CO, MI | ROO, IIH, CE | RegOut, IIL    | IOL, JMP     | EndCMD            | Not Used    | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used | Not Used |

</div>

## Composite Instructions (only available via Assembler):

<div style="overflow-x: auto;">

| Composite Instruction | Description                                                                           | Instruction 1 | Instruction 2 | Instruction 3 | Instruction 4 | Instruction 5 | Instruction 6 | Instruction 7 | Instruction 8 | Example Command                    |
|-----------------------|---------------------------------------------------------------------------------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|------------------------------------|
| INC A                 | Increment A Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (ADD)     | SPAPOP        | N/A           | N/A           | INC A                              |
| DEC A                 | Decrement A Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (SUB)     | SPAPOP        | N/A           | N/A           | DEC A                              |
| INC B                 | Increment B Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (ADD)     | SPAPOP        | N/A           | N/A           | INC B                              |
| DEC B                 | Decrement B Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (SUB)     | SPAPOP        | N/A           | N/A           | DEC B                              |
| INC X                 | Increment X Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (ADD)     | SPAPOP        | N/A           | N/A           | INC X                              |
| DEC X                 | Decrement X Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (SUB)     | SPAPOP        | N/A           | N/A           | DEC X                              |
| INC Y                 | Increment Y Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (ADD)     | SPAPOP        | N/A           | N/A           | INC Y                              |
| DEC Y                 | Decrement Y Register by 1                                                             | SPAPUSH       | LDI           | ALULD1        | ALULD2        | ALU (SUB)     | SPAPOP        | N/A           | N/A           | DEC Y                              |
| POP                   | Increment Stack Pointer and Pull from Stack to a register                             | SPAPOP        | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | POP A                              |
| PUSH                  | Push from register to Stack and then decrement the stack pointer                      | SPAPUSH       | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | PUSH X                             |
| DISPTXT               | Push immediate value to register, then output to addressable IO                       | LDI           | IOI           | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | DISPTXT X, [Hello World], [0x0004] |
| CMP                   | Compare two registers and set flags                                                   | ALULD1        | ALULD2        | CMP [SUB]     | N/A           | N/A           | N/A           | N/A           | N/A           | CMP A, B                           |
| CMPMEMA               | Compare A register with the contents of a RAM location                                | SPAPUSH       | LD            | ALULD1        | ALULD2        | CMP [SUB]     | SPAPOP        | N/A           | N/A           | CMPMEMA [0x00FE]                   |
| CMPMEMB               | Compare B register with the contents of a RAM location                                | SPAPUSH       | LD            | ALULD1        | ALULD2        | CMP [SUB]     | SPAPOP        | N/A           | N/A           | CMPMEMB [0x00FE]                   |
| CMPMEMX               | Compare X register with the contents of a RAM location                                | SPAPUSH       | LD            | ALULD1        | ALULD2        | CMP [SUB]     | SPAPOP        | N/A           | N/A           | CMPMEMX [0x00FE]                   |
| CMPMEXY               | Compare Y register with the contents of a RAM location                                | SPAPUSH       | LD            | ALULD1        | ALULD2        | CMP [SUB]     | SPAPOP        | N/A           | N/A           | CMPMEMY [0x00FE]                   |
| SHL                   | Shift left by 1 bit                                                                   | ALULD1        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | SHL A                              |
| SHR                   | Shift right by 1 bit                                                                  | ALULD1        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | SHR B                              |
| ADD                   | Add contents of two registers and set flags                                           | ALULD1        | ALULD2        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | ADD A, B, X                        |
| SUB                   | Subtract contents of two registers and set flags                                      | ALULD1        | ALULD2        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | SUB A, B, X                        |
| AND                   | AND contents of two registers and set flags                                           | ALULD1        | ALULD2        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | AND A, B, X                        |
| OR                    | OR contents of two registers and set flags                                            | ALULD1        | ALULD2        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | OR A, B, X                         |
| XOR                   | XOR contents of two registers and set flags                                           | ALULD1        | ALULD2        | ALU           | N/A           | N/A           | N/A           | N/A           | N/A           | XOR A, B, X                        |
| JSR                   | Jumps to a PC location (sub-routine) while storing the post JSR location in the stack | LDI           | SPAPUSH       | JMP           | N/A           | N/A           | N/A           | N/A           | N/A           | JSR Label                          |
| RET                   | Return from sub-routine (to PC location set in the stack during JSR)                  | SPAPOP        | JMPR          | N/A           | N/A           | N/A           | N/A           | N/A           | N/A           | RET                                |

</div>